version: '3.8'

services:
  technical-analyzer-agent:
    build: ./agents/01_technical_analyzer_agent
    env_file: .env
    restart: always
    ports:
      - "8002:8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s

  fibonacci-cyclical-agent:
    build: ./agents/03_fibonacci_cyclical_agent
    env_file: .env
    restart: always
    ports:
      - "8003:8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s

  gann-analyzer-agent:
    build: ./agents/05_gann_analyzer_agent
    env_file: .env
    restart: always
    ports:
      - "8005:8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s

  master-ai-agent:
    build: ./agents/04_master_ai_agent
    env_file: .env
    restart: always
    ports:
      - "8004:8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s

  position-manager-agent:
    build: ./agents/07_position_manager_agent
    env_file: .env
    restart: always
    ports:
      - "8007:8000"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/docs"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 20s
      
  orchestrator:
    build: ./orchestrator
    env_file: .env
    restart: always
    depends_on:
      technical-analyzer-agent:
        condition: service_healthy
      fibonacci-cyclical-agent:
        condition: service_healthy
      gann-analyzer-agent:
        condition: service_healthy
      master-ai-agent:
        condition: service_healthy
      position-manager-agent:
        condition: service_healthy
